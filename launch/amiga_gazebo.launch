<?xml version="1.0"?>
<launch>

  <arg name="gui" default="true" doc="Starts gazebo gui" />
  <arg name="namespace" default="xarm"/>
  <arg name="add_gripper" default="false" />
  <arg name="add_vacuum_gripper" default="false" />
  <arg name="xarm_velocity_control"  />
  <arg name="attach_to" default="world"/>
  <arg name="xyz" default="'0.3 0 0.8382'"/>
  <arg name="rpy" default="'0 3.1417 3.1417'"/>
  <arg name="x_pos" default="-0.528"/>
  <arg name="y_pos" default="-3.0"/>
  <arg name="z_pos" default="0.0"/>
  <arg name="yaw" default="3.14"/>
  
  <rosparam file="$(find xarm6_moveit_config)/config/xarm6_params.yaml" command="load" ns="$(arg namespace)"/>
  <rosparam if="$(arg add_gripper)" file="$(find xarm_controller)/config/gripper_gazebo_ros_control.yaml" command="load"/>
  <!-- startup simulated world -->
  <include file="$(find gazebo_ros)/launch/empty_world.launch">
    <!--arg name="world_name" value="$(find xarm_gazebo)/worlds/rough_terrain_hard.world"/-->
    <arg name="world_name" value="$(find iowa_navigation)/worlds/mature_soybean2.world"/>
    <arg name="gui" value="$(arg gui)"/>
    <arg name="use_sim_time" default="false"/>
  </include>

  <!-- send robot urdf to param server, joint limit may be overwritten if use moveit planner -->
  <param unless="$(eval arg('add_gripper') or arg('add_vacuum_gripper'))" name="robot_description"
    command="$(find xacro)/xacro
    --inorder '$(find xarm_description)/urdf/xarm6_robot_custom.urdf.xacro'
    attach_to:=$(arg attach_to) 
    xyz:=$(arg xyz) 
    rpy:=$(arg rpy)"
    />

  <param if="$(arg add_gripper)" name="robot_description"
    command="$(find xacro)/xacro
    --inorder '$(find xarm_description)/urdf/xarm6_with_gripper_custom.xacro'
      attach_to:=$(arg attach_to) 
      xyz:=$(arg xyz) 
      rpy:=$(arg rpy)     	
   	  "/>
<param name="amiga_description" command="$(find xacro)/xacro --inorder $(find iowa_navigation)/urdf/husky_with_Lidar.urdf.xacro" />

  <!-- spawn robot model in gazebo, located on the table -->
  
  <node pkg="gazebo_ros" type="spawn_model" name="spawn_urdf" args="-urdf -model farm_ng -x $(arg x_pos) -y $(arg y_pos) -z $(arg z_pos) -Y $(arg yaw) -unpause  -urdf -param amiga_description" />

  <!-- load the corresponding controllers -->
  <include file="$(find xarm_controller)/launch/xarm6_control.launch">
    <arg name="add_gripper" value="$(arg add_gripper)" />
    <arg name="namespace" value="$(arg namespace)" />
  </include>

</launch>
